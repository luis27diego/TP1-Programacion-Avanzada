<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultados Hist칩ricos - Trivia de Pel칤culas</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>游끥 Resultados Hist칩ricos</h1>
            <p>Historial de todas las partidas jugadas con an치lisis gr치fico</p>
        </header>
        
        <main>
            <section class="results-section">
                {% if games %}
                    <!-- Gr치ficas -->
                    <div class="charts-section">
                        <h2>游늵 An치lisis Gr치fico de Resultados</h2>
                        
                        <!-- Gr치fica de l칤neas -->
                        <div class="chart-container">
                            <h3>游늳 Evoluci칩n de Aciertos y Desaciertos por Fecha</h3>
                            {% if line_chart_url %}
                                <img src="{{ line_chart_url }}" alt="Gr치fica de l칤neas" class="chart-image">
                                <p class="chart-description">
                                    Esta gr치fica muestra la evoluci칩n temporal de los aciertos y desaciertos 
                                    a lo largo del tiempo, permitiendo identificar tendencias y patrones 
                                    en el rendimiento de los jugadores.
                                </p>
                            {% else %}
                                <p class="no-chart">No hay suficientes datos para generar la gr치fica de l칤neas.</p>
                            {% endif %}
                        </div>
                        
                        <!-- Gr치fica circular -->
                        <div class="chart-container">
                            <h3>游볺 Distribuci칩n Total de Aciertos y Desaciertos</h3>
                            {% if pie_chart_url %}
                                <img src="{{ pie_chart_url }}" alt="Gr치fica circular" class="chart-image">
                                <p class="chart-description">
                                    Esta gr치fica circular muestra la distribuci칩n porcentual total de 
                                    aciertos versus desaciertos acumulados por todos los jugadores.
                                </p>
                            {% else %}
                                <p class="no-chart">No hay suficientes datos para generar la gr치fica circular.</p>
                            {% endif %}
                        </div>
                        
                        <!-- Botones de descarga -->
                        <div class="download-section">
                            <h3>游닌 Descargar Reporte Completo</h3>
                            <p>Descarga un reporte PDF completo con todas las gr치ficas y estad칤sticas detalladas.</p>
                            {% if pdf_report_url %}
                                <a href="{{ pdf_report_url }}" class="btn btn-success" download>
                                    游늯 Descargar Reporte PDF
                                </a>
                            {% else %}
                                <a href="{{ url_for('generar_reporte_pdf') }}" class="btn btn-success">
                                    游댃 Generar y Descargar Reporte PDF
                                </a>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Tabla de resultados -->
                    <div class="results-table">
                        <h2>游늶 Tabla de Resultados</h2>
                        <table>
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Jugador</th>
                                    <th>Puntuaci칩n</th>
                                    <th>Frases</th>
                                    <th>Fecha y Hora</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for game in games %}
                                    <tr>
                                        <td>{{ loop.index }}</td>
                                        <td>{{ game.username }}</td>
                                        <td class="score">{{ game.score }}</td>
                                        <td>{{ game.num_phrases }}</td>
                                        <td>{{ game.start_time }}</td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Estad칤sticas -->
                    <div class="stats-summary">
                        <h3>游늳 Estad칤sticas Generales</h3>
                        <ul>
                            <li><strong>Total de partidas:</strong> {{ games|length }}</li>
                            <li><strong>Total de jugadores 칰nicos:</strong> {{ games|map(attribute='username')|unique|list|length }}</li>
                            {% if games %}
                                {% set total_phrases = games|sum(attribute='num_phrases') %}
                                <li><strong>Total de frases respondidas:</strong> {{ total_phrases }}</li>
                            {% endif %}
                        </ul>
                    </div>
                {% else %}
                    <div class="no-results">
                        <h3>No hay resultados hist칩ricos</h3>
                        <p>춰S칠 el primero en jugar una partida para ver las gr치ficas y estad칤sticas!</p>
                    </div>
                {% endif %}
            </section>
            
            <section class="navigation">
                <a href="{{ url_for('index') }}" class="btn btn-primary">游 Volver al Inicio</a>
                <a href="{{ url_for('listar_peliculas') }}" class="btn btn-secondary">游늶 Ver Pel칤culas</a>
                {% if games %}
                    <a href="{{ url_for('actualizar_graficas') }}" class="btn btn-info">游댃 Actualizar Gr치ficas</a>
                {% endif %}
            </section>
        </main>
        
        <footer>
            <p>&copy; 2024 Trivia de Pel칤culas - Programaci칩n Avanzada</p>
        </footer>
    </div>
</body>
</html>
